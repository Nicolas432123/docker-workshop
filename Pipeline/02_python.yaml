id: python_02
namespace: zoomcamp

description: This flow installs pip packages in a Docker container and uses Kestra's Python SDK.

tasks:
  - id: collect_stats
    type: io.kestra.plugin.scripts.python.Script
    taskRunner:
      type: io.kestra.plugin.scripts.runner.docker.Docker
      image: python:slim
    dependencies:
      - requests
      - kestra
    script: |
      from kestra import Kestra
      import requests

      def get_docker_image_downloads(image_name: str = "kestra/kestra"):
          url = f"https://hub.docker.com/v2/repositories/{image_name}/"
          response = requests.get(url)
          data = response.json()
          return data.get("pull_count", "Not available")

      downloads = get_docker_image_downloads()

      Kestra.outputs({
          "downloads": downloads
      })
